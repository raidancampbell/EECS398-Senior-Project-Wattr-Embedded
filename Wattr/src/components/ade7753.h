/*
 * ade7753.h
 *
 * Created: 12 Nov 2013 10:12:55 AM
 *  Author: Andrew
 */ 


#ifndef ADE7753_H_
#define ADE7753_H_


#define SPI_CHIP_SEL			  1
#define SPI_CLK_POLARITY		  0
#define SPI_CLK_PHASE			  0
#define SPI_DLYBS				  0x40
#define SPI_DLYBCT				  0x10
static uint32_t gs_ul_spi_clock = 500000;

// The number of bits the register is in bytes
#define BITS6  1
#define BITS8  1
#define BITS12 2
#define BITS16 2
#define BITS24 3

// All write operations must be OR'ed with 0b10......
#define ADE7753_WRITE_MASK					0b10000000


// Listing of registers on the chip. See Page 52-54 on the datasheet
#define ADE7753_REGISTER_WAVEFORM			0x01
#define ADE7753_REGISTER_WAVEFORM_BYTES		BITS24

#define ADE7753_REGISTER_AENERGY			0x02
#define ADE7753_REGISTER_AENERGY_BYTES		BITS24

#define ADE7753_REGISTER_RAENERGY			0x03
#define ADE7753_REGISTER_RAENERGY_BYTES		BITS24

#define ADE7753_REGISTER_LAENERGY			0x04
#define ADE7753_REGISTER_LAENERGY_BYTES		BITS24

#define ADE7753_REGISTER_VAENERGY			0x05
#define ADE7753_REGISTER_VAENERGY_BYTES		BITS24

#define ADE7753_REGISTER_RVAENERGY			0x06
#define ADE7753_REGISTER_RVAENERGY_BYTES	BITS24

#define ADE7753_REGISTER_LVAENERGY			0x07
#define ADE7753_REGISTER_LVAENERGY_BYTES	BITS24

#define ADE7753_REGISTER_LVARENERGY			0x08
#define ADE7753_REGISTER_LVARENERGY_BYTES	BITS24

#define ADE7753_REGISTER_MODE				0x09
#define ADE7753_REGISTER_MODE_BYTES			BITS16

#define ADE7753_REGISTER_IRQEN				0x0A
#define ADE7753_REGISTER_IRQEN_BYTES		BITS16

#define ADE7753_REGISTER_STATUS				0x0B
#define ADE7753_REGISTER_STATUS_BYTES		BITS16

#define ADE7753_REGISTER_RSTSTATUS			0x0C
#define ADE7753_REGISTER_RSTSTATUS_BYTES	BITS16

#define ADE7753_REGISTER_CH1OS				0x0D
#define ADE7753_REGISTER_CH1OS_BYTES		BITS8

#define ADE7753_REGISTER_CH2OS				0x0E
#define ADE7753_REGISTER_CH2OS_BYTES		BITS8

#define ADE7753_REGISTER_GAIN				0x0F
#define ADE7753_REGISTER_GAIN_BYTES			BITS8

#define ADE7753_REGISTER_PHCAL				0x10
#define ADE7753_REGISTER_PHCAL_BYTES		BITS6

#define ADE7753_REGISTER_APOS				0x11
#define ADE7753_REGISTER_APOS_BYTES			BITS16

#define ADE7753_REGISTER_WGAIN				0x12
#define ADE7753_REGISTER_WGAIN_BYTES		BITS12

#define ADE7753_REGISTER_WDIV				0x13
#define ADE7753_REGISTER_WDIV_BYTES			BITS8

#define ADE7753_REGISTER_CFNUM				0x14
#define ADE7753_REGISTER_CFNUM_BYTES		BITS12

#define ADE7753_REGISTER_CFDEN				0x15
#define ADE7753_REGISTER_CFDEN_BYTES		BITS12

#define ADE7753_REGISTER_IRMS				0x16
#define ADE7753_REGISTER_IRMS_BYTES			BITS24

#define ADE7753_REGISTER_VRMS				0x17
#define ADE7753_REGISTER_VRMS_BYTES			BITS24

#define ADE7753_REGISTER_IRMSOS				0x18
#define ADE7753_REGISTER_IRMSOS_BYTES		BITS12

#define ADE7753_REGISTER_VRMSOS				0x19
#define ADE7753_REGISTER_VRMSOS_BYTES		BITS12

#define ADE7753_REGISTER_VAGAIN				0x1A
#define ADE7753_REGISTER_VAGAIN_BYTES		BITS12

#define ADE7753_REGISTER_VADIV				0x1B
#define ADE7753_REGISTER_VADIV_BYTES		BITS8

#define ADE7753_REGISTER_LINECYC			0x1C
#define ADE7753_REGISTER_LINECYC_BYTES		BITS16

#define ADE7753_REGISTER_ZXTOUT				0x1D
#define ADE7753_REGISTER_ZXTOUT_BYTES		BITS12

#define ADE7753_REGISTER_SAGCYC				0x1E
#define ADE7753_REGISTER_SAGCYC_BYTES		BITS8

#define ADE7753_REGISTER_SAGLVL				0x1F
#define ADE7753_REGISTER_SAGLVL_BYTES		BITS8

#define ADE7753_REGISTER_IPKLVL				0x20
#define ADE7753_REGISTER_IPKLVL_BYTES		BITS8

#define ADE7753_REGISTER_VPKLVL				0x21
#define ADE7753_REGISTER_VPKLVL_BYTES		BITS8

#define ADE7753_REGISTER_IPEAK				0x22
#define ADE7753_REGISTER_IPEAK_BYTES		BITS24

#define ADE7753_REGISTER_RSTIPEAK			0x23
#define ADE7753_REGISTER_RSTIPEAK_BYTES		BITS24

#define ADE7753_REGISTER_VPEAK				0x24
#define ADE7753_REGISTER_VPEAK_BYTES		BITS24

#define ADE7753_REGISTER_RSTVPEAK			0x25
#define ADE7753_REGISTER_RSTVPEAK_BYTES		BITS24

#define ADE7753_REGISTER_TEMP				0x26
#define ADE7753_REGISTER_TEMP_BYTES			BITS8

#define ADE7753_REGISTER_PERIOD				0x27
#define ADE7753_REGISTER_PERIOD_BYTES		BITS16

#define ADE7753_REGISTER_CHKSUM				0x3E
#define ADE7753_REGISTER_CHKSUM_BYTES		BITS6

#define ADE7753_REGISTER_DIEREV				0x3F
#define ADE7753_REGISTER_DIEREV_BYTES		BITS8

static void spi_master_initialize(void);
static void spi_master_transfer(void *p_buf, uint32_t size);
void ade7753_read(uint8_t ic_register, void *data, uint8_t length, uint8_t *checksum);
void ade7753_write(uint8_t ic_register, void *data, uint8_t length);
uint8_t verify_result(uint32_t *result, uint8_t *checksum);

#endif /* ADE7753_H_ */